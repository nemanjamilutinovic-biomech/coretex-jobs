name: Linter code check

on:
  push:
    branches:
      - main
      - stage
      - develop
  pull_request:
    types: [opened, reopened, synchronize]
    branches:
      - main
      - stage
      - develop

jobs:
  define-dirs:
    runs-on: ubuntu-latest
    outputs:
      dirs: ${{ steps.dirs.outputs.dirs }}
    steps:
      - uses: actions/checkout@v3
      - name: Define Dirs
        id: dirs
        run: dirs=($(ls -d tasks/*/)) &&
         echo 'dirs=[ "tasks/annotated-image-extractor" "tasks/image-quality-predictor" "tasks/qiime-otu-clustering"]' >> "$GITHUB_OUTPUT"
  build:
    runs-on: ubuntu-latest
    needs: define-dirs
    strategy:
      matrix:
        dirs: ${{ fromJSON(needs.define-dirs.outputs.dirs) }}
# echo "dirs=[$(printf '"%s", ' "${dirs[@]}")]"
#         [
#   "tasks/annotated-image-extractor", "tasks/image-quality-predictor", "tasks/qiime-otu-clustering",
#   "tasks/audio-analytics", "tasks/image-segmentation", "tasks/qiime-taxonomic-analysis",
#   "tasks/bio-bodysite-prediction", "tasks/llama2-lora", "tasks/qiime-tree-phylogenetic-diversity-analysis",
#   "tasks/bio-bodysite-prediction-nn", "tasks/llm-text-processing", "tasks/r-alpha-beta-diversity",
#   "tasks/bio-primer-removal", "tasks/model-comparison", "tasks/r-compare-dada2-results",
#   "tasks/bio-read-quality", "tasks/model-transfer", "tasks/r-dada2",
#   "tasks/bio-region-seperation", "tasks/object-detection-yolov10", "tasks/r-experiment",
#   "tasks/bio-sequence-alignment", "tasks/object-detection-yolov8", "tasks/r-phylogenetic-tree", "tasks/ollama-chatbot-fn", "tasks/s3-model-upload",
#   "tasks/contextual-targeting", "tasks/ollama-rag-index", "tasks/sql-connector",
#   "tasks/dataset-merge", "tasks/ollama-sentiment-analysis-fn", "tasks/stable-diffusion", "tasks/qiime-alpha-beta-diversity", "tasks/stable-diffusion-fn",
#   "tasks/image-augmentation", "tasks/qiime-dada2", "tasks/synthetic-image-generator",
#   "tasks/image-extractor", "tasks/qiime-demultiplexing", "tasks/tabular-data-diagnostics",
#   "tasks/image-orientation", "tasks/qiime-import", "tasks/translation-ollama"
# ]
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: "3.9"
      - name: Install mypy globally
        run: |
          pip install mypy
      - name: Analysing templates with mypy
        run: |
          bash .github/workflows/linter-code-check.sh ${{matrix.dirs}}
